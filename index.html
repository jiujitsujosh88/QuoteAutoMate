<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Quote AutoMate – Skeleton</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0f1115"/>
  <style>
    :root{ --bg:#0f1115; --card:#151924; --text:#e9eef8; --muted:#a9b3c9; --accent:#3aa3ff; --border:#232836; }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;}

    /* Header */
    .app-header{position:sticky;top:0;z-index:10;display:flex;align-items:center;justify-content:space-between;
      padding:12px 16px;background:linear-gradient(180deg,rgba(21,25,36,.95),rgba(21,25,36,.85));
      backdrop-filter: blur(8px);border-bottom:1px solid var(--border);}
    .app-title{font-weight:700;letter-spacing:.2px;user-select:none;cursor:default}
    .net{font-size:.78rem;padding:4px 8px;border-radius:999px;border:1px solid var(--border);background:#101521;}
    .net.online{color:#5ee17d}.net.offline{color:#ff8b8b}

    /* Main */
    #tab-content{padding:16px;padding-bottom:96px;min-height:calc(100dvh - 120px);}
    .tab-pane{display:none}
    .tab-pane.active{display:block}
    .tab-pane::before{content:attr(aria-label);display:inline-block;font-weight:700;color:var(--muted);
      margin-bottom:10px;padding:6px 10px;border:1px solid var(--border);border-radius:8px;}
    .placeholder{margin-top:8px;padding:12px;border:1px dashed var(--border);border-radius:8px;color:var(--muted);}

    /* Bottom Tabbar (5 + More) */
    .tabbar{position:fixed;bottom:0;left:0;right:0;z-index:20;display:grid;grid-template-columns:repeat(6,1fr);
      gap:0;padding:8px;border-top:1px solid var(--border);
      background:linear-gradient(180deg,rgba(15,17,21,.8),rgba(15,17,21,.95));backdrop-filter: blur(8px);}
    .tab-btn{background:transparent;color:var(--muted);border:none;padding:10px 6px;border-radius:10px;font-weight:600;letter-spacing:.2px}
    .tab-btn.active{color:var(--text);background:rgba(58,163,255,.14);}

    /* <dialog> More */
    dialog.more-dialog{width:min(560px,92vw);border:1px solid var(--border);border-radius:18px;background:var(--card);color:var(--text)}
    dialog.more-dialog::backdrop{background:rgba(0,0,0,.35)}
    .more-wrap{padding:12px}
    .more-title{font-weight:700;padding:6px 4px 10px 4px;}
    .more-item,.more-close,.more-update{width:100%;text-align:left;margin:6px 0;background:#101521;color:var(--text);
      border:1px solid var(--border);border-radius:10px;padding:12px}
    .more-close{text-align:center;background:#182034}
    .more-update{border-style:dashed}
  </style>
</head>
<body>
  <!-- Header -->
  <header class="app-header">
    <div id="app-title" class="app-title" title="Long-press to Force Update">Quote AutoMate</div>
    <div id="net-status" class="net">Online</div>
  </header>

  <!-- Main content -->
  <main id="tab-content">
    <!-- Primary Tabs -->
    <section id="tab-quotes" class="tab-pane" role="region" aria-label="Quotes"></section>
    <section id="tab-history" class="tab-pane" role="region" aria-label="History"></section>
    <section id="tab-customers" class="tab-pane" role="region" aria-label="Customers"></section>
    <section id="tab-presets" class="tab-pane" role="region" aria-label="Presets"></section>
    <section id="tab-analytics" class="tab-pane" role="region" aria-label="Analytics"></section>

    <!-- Secondary Tabs (More) -->
    <section id="tab-settings" class="tab-pane" role="region" aria-label="Settings" hidden></section>
    <section id="tab-business" class="tab-pane" role="region" aria-label="Business Info" hidden></section>
    <section id="tab-resources" class="tab-pane" role="region" aria-label="Resources" hidden></section>
  </main>

  <!-- Bottom Tab Bar -->
  <nav class="tabbar" aria-label="Bottom Tabs">
    <button class="tab-btn" data-tab="quotes" aria-label="Quotes">Quotes</button>
    <button class="tab-btn" data-tab="history" aria-label="History">History</button>
    <button class="tab-btn" data-tab="customers" aria-label="Customers">Customers</button>
    <button class="tab-btn" data-tab="presets" aria-label="Presets">Presets</button>
    <button class="tab-btn" data-tab="analytics" aria-label="Analytics">Analytics</button>
    <button class="tab-btn" id="btn-more" data-tab="more" aria-label="More">More</button>
  </nav>

  <!-- Native dialog (More) -->
  <dialog id="moreDialog" class="more-dialog" aria-labelledby="moreTitle" inert>
    <div class="more-wrap">
      <div id="moreTitle" class="more-title">More</div>
      <button class="more-item" data-tab="settings">Settings</button>
      <button class="more-item" data-tab="business">Business Info</button>
      <button class="more-item" data-tab="resources">Resources</button>
      <button class="more-update" id="force-update">Force Update (clear cache & reload)</button>
      <button id="more-close" class="more-close">Close</button>
    </div>
  </dialog>

  <script>
  (function(){
    const State = { activeTab: 'quotes' };
    const $ = (sel, root=document) => root.querySelector(sel);
    const $all = (sel, root=document) => Array.from(root.querySelectorAll(sel));

    // ---------- Force Update (shared) ----------
    async function forceUpdate(){
      try {
        if ('caches' in window) {
          const keys = await caches.keys();
          await Promise.all(keys.map(k => caches.delete(k)));
        }
        if (navigator.serviceWorker?.controller) {
          navigator.serviceWorker.controller.postMessage({type:'SKIP_WAITING'});
        }
      } catch(e){}
      location.reload();
    }
    function checkResetFlag(){
      const url = new URL(location.href);
      if (url.searchParams.get('reset') === '1') forceUpdate();
    }
    function initEasterReset(){
      const title = $('#app-title'); if (!title) return;
      let t=null;
      const start=()=>{ t=setTimeout(()=>forceUpdate(),600); };
      const clear=()=>{ if(t){clearTimeout(t);t=null;} };
      title.addEventListener('mousedown', start);
      title.addEventListener('touchstart', start, {passive:true});
      ['mouseup','mouseleave','touchend','touchcancel'].forEach(ev=>title.addEventListener(ev, clear, {passive:true}));
    }

    // ---------- Network badge ----------
    function setOnlineStatus(){
      const el = $('#net-status'); if(!el) return;
      const online = navigator.onLine;
      el.textContent = online ? 'Online' : 'Offline';
      el.classList.toggle('online', online);
      el.classList.toggle('offline', !online);
    }
    function initNet(){
      setOnlineStatus();
      addEventListener('online', setOnlineStatus);
      addEventListener('offline', setOnlineStatus);
    }

    // ---------- Tabs ----------
    function showTab(tab){
      $all('.tab-pane').forEach(p => { p.classList.remove('active'); p.hidden = true; });
      const pane = $('#tab-' + tab);
      if (pane){ pane.hidden = false; pane.classList.add('active'); }
      $all('.tab-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.tab === tab));
      closeMore();
      State.activeTab = tab;
      try { localStorage.setItem('lastTab', tab); } catch(_) {}
    }

    // ---------- More (dialog) ----------
    const dlg = $('#moreDialog');
    function supportsDialog(){ return typeof HTMLDialogElement !== 'undefined' && 'showModal' in dlg; }

    function openMore(){
      if (supportsDialog()){
        dlg.removeAttribute('inert');
        dlg.showModal();
      } else {
        // Fallback if dialog unsupported
        alert('Settings • Business Info • Resources\n\n(Your browser lacks <dialog> support in this mode.)');
      }
    }
    function closeMore(){
      if (supportsDialog() && dlg.open){
        dlg.close();
        dlg.setAttribute('inert',''); // prevent focus if somehow reflowed
      }
    }
    function wireMore(){
      $('#btn-more')?.addEventListener('click', (e)=>{ e.preventDefault(); openMore(); }, {passive:false});
      $('#more-close')?.addEventListener('click', (e)=>{ e.preventDefault(); closeMore(); });
      dlg?.addEventListener('click', (e)=>{
        const box = e.target.closest('.more-wrap');
        if (!box) closeMore();
      });
      $all('.more-item', dlg).forEach(item=>{
        item.addEventListener('click',(e)=>{
          e.preventDefault(); e.stopPropagation();
          const t=item.dataset.tab; if (t) showTab(t);
        }, {passive:false});
      });
      // Force Update button inside dialog
      $('#force-update')?.addEventListener('click', forceUpdate);
    }

    // ---------- Placeholders ----------
    function mountPlaceholders(){
      const fillers = {
        quotes:'Start your quote flow here.',
        history:'Recent quotes. (Later: quick-add from prior tickets.)',
        customers:'Customer list & quick search.',
        presets:'Your saved presets will appear here.',
        analytics:'KPIs & date-range reports.',
        settings:'Language, currency, role.',
        business:'Business name, logo, contact, financial defaults.',
        resources:'Employees, sublets, suppliers.'
      };
      Object.entries(fillers).forEach(([k,t])=>{
        const el = $('#tab-'+k);
        if (el && !el.dataset.mounted){
          const block = document.createElement('div');
          block.className = 'placeholder'; block.textContent = t;
          el.appendChild(block); el.dataset.mounted='1';
        }
      });
    }

    // ---------- Boot ----------
    document.addEventListener('DOMContentLoaded', ()=>{
      checkResetFlag();
      initEasterReset();
      initNet();
      // wire bottom tabs
      $all('.tab-btn').forEach(btn=>{
        btn.addEventListener('click', (e) => {
          const t = btn.dataset.tab;
          if (t === 'more'){ openMore(); return; }
          showTab(t);
        }, {passive:true});
      });
      wireMore();
      mountPlaceholders();
      // restore last tab
      let last = 'quotes';
      try { const saved = localStorage.getItem('lastTab'); if (saved) last = saved; } catch(_) {}
      showTab(last);
    });
  })();
  </script>
</body>
</html>